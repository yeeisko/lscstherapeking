<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Find plist links</title>
</head>
<body>
  <h3>Check website for plist links</h3>
  <input type="text" id="urlInput" placeholder="Enter website URL" style="width: 300px;" />
  <button id="checkBtn">Check</button>
  <p id="result"></p>

  <script>
    document.getElementById('checkBtn').onclick = async function () {
      let url = document.getElementById('urlInput').value.trim();
      const resultEl = document.getElementById('result');
      resultEl.textContent = 'Loading...';

      if (!url) {
        resultEl.textContent = 'Please enter a URL';
        return;
      }

      if (!/^https?:\/\//i.test(url)) {
        url = 'https://' + url;
      }

      try {
        // Use a CORS proxy (change or remove if you have a backend)
        const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
        const response = await fetch(proxyUrl + url);
        if (!response.ok) throw new Error('Failed to fetch the URL');

        const htmlText = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlText, 'text/html');

        // Find all <a>, <link>, <script>, <iframe>, <img> elements with href/src ending in .plist
        const elements = [
          ...doc.querySelectorAll('a[href$=".plist"], link[href$=".plist"], script[src$=".plist"], iframe[src$=".plist"], img[src$=".plist"]')
        ];

        // Extract URLs from attributes
        const urls = elements.map(el => el.href || el.src).filter(Boolean);

        // Also search raw text for .plist links (including itms://)
        const regex = /(?:itms[-a-z]*:|https?:\/\/)?[^\s"'<>]*\.plist\b/gi;
        const textMatches = htmlText.match(regex) || [];

        // Combine and remove duplicates
        const allMatches = Array.from(new Set([...urls, ...textMatches]));

        if (allMatches.length > 0) {
          resultEl.innerHTML = 'Found plist link(s):<br>' + allMatches.join('<br>');
        } else {
          resultEl.textContent = 'No plist links found.';
        }
      } catch (error) {
        resultEl.textContent = 'Error: ' + error.message + '. CORS restrictions may block requests to other sites. Use a proxy or server-side code.';
      }
    };
  </script>
</body>
</html>
