<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PEM and Private Key Matcher with node-forge</title>
<style>
  body { font-family: Arial, sans-serif; margin: 2em; max-width: 700px; }
  textarea { width: 100%; height: 150px; margin-bottom: 1em; font-family: monospace; }
  button { padding: 0.5em 1em; font-size: 1em; }
  #result { margin-top: 1em; font-weight: bold; }
</style>
</head>
<body>
<h2>Match .pem Certificate and .key Private Key</h2>
<p>Paste your <strong>.pem</strong> certificate and <strong>.key</strong> private key contents below, then click "Check Match".</p>

<label for="pemInput">.pem Certificate (Public Certificate)</label><br/>
<textarea id="pemInput" placeholder="-----BEGIN CERTIFICATE----- ... -----END CERTIFICATE-----"></textarea>

<label for="keyInput">.key Private Key</label><br/>
<textarea id="keyInput" placeholder="-----BEGIN PRIVATE KEY----- ... -----END PRIVATE KEY-----"></textarea>

<button id="checkBtn">Check Match</button>

<div id="result"></div>

<script src="https://cdn.jsdelivr.net/npm/node-forge@1.3.1/dist/forge.min.js"></script>
<script>
  function getPublicKeyFromCert(pemCert) {
    const forge = window.forge;
    const cert = forge.pki.certificateFromPem(pemCert);
    return cert.publicKey;
  }

  function getPublicKeyFromPrivateKey(pemKey) {
    const forge = window.forge;
    // Attempt to parse private key from PEM
    try {
      return forge.pki.privateKeyFromPem(pemKey).publicKey || forge.pki.setRsaPublicKey(
        forge.pki.privateKeyFromPem(pemKey).n,
        forge.pki.privateKeyFromPem(pemKey).e
      );
    } catch {
      // If standard parse fails, try as PKCS#8 or encrypted key with empty password
      const privateKey = forge.pki.decryptRsaPrivateKey(pemKey, '');
      if (!privateKey) throw new Error('Invalid private key format');
      return forge.pki.setRsaPublicKey(privateKey.n, privateKey.e);
    }
  }

  function getPublicKeyFingerprint(publicKey) {
    const forge = window.forge;
    const asn1 = forge.pki.publicKeyToAsn1(publicKey);
    const der = forge.asn1.toDer(asn1).getBytes();
    const md = forge.md.sha256.create();
    md.update(der);
    return md.digest().toHex();
  }

  function checkMatch() {
    const pem = document.getElementById('pemInput').value.trim();
    const key = document.getElementById('keyInput').value.trim();
    const resultDiv = document.getElementById('result');
    resultDiv.textContent = '';
    resultDiv.style.color = 'black';

    if (!pem || !key) {
      resultDiv.textContent = 'Please provide both the certificate and private key.';
      resultDiv.style.color = 'red';
      return;
    }

    try {
      const certPubKey = getPublicKeyFromCert(pem);
      const privPubKey = getPublicKeyFromPrivateKey(key);

      const certFingerprint = getPublicKeyFingerprint(certPubKey);
      const privFingerprint = getPublicKeyFingerprint(privPubKey);

      if (certFingerprint === privFingerprint) {
        resultDiv.textContent = '✅ The private key matches the certificate.';
        resultDiv.style.color = 'green';
      } else {
        resultDiv.textContent = '❌ The private key does NOT match the certificate.';
        resultDiv.style.color = 'red';
      }
    } catch (e) {
      resultDiv.textContent = 'Error parsing keys: ' + e.message;
      resultDiv.style.color = 'red';
    }
  }

  document.getElementById('checkBtn').addEventListener('click', checkMatch);
</script>
</body>
</html>
